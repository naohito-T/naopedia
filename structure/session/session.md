# Session
[セッション概要](https://www.kwbtblog.com/entry/2019/04/20/005423)

## HTTP通信んの問題点

- HTTP通信は1回1回の単発の通信のため接続を維持することができない。
- HTTP通信はユーザー識別の仕組みがないので、どのユーザーからの接続かを判別することができない。なので、一連のHTTP通信で、ユーザー接続を維持し続けるには、何かしらの仕組みを実装する必要がある

## 解決方法

ユーザー認証完了後、サーバー側でユーザー識別子を発行しブラウザへのレスポンスで識別子を送る。  
次回以降ブラウザからサーバーにアクセスする際、毎回その識別子をサーバーに送ることにより、サーバー側でどのユーザーからのアクセスかがわかるようにする。  
そして、その識別子のやり取り方法の1つとして、クッキーを用いる方法がある。

## セッションについて

- セッションIDの生成方法はHTTPの仕様として定まっていない。**サーバー側の実装に依存する**
- 各プログラム言語にはメジャーなセッションライブラリがあり、セッションID生成には、それらを使うことが多い
- それらのライブラリの多くのデフォルトの実装は、セッションIDとしてユニークで推測しずらい値を生成し、それをキーとして「ユーザーID」などのユーザーデータを紐付けて、**ローカルファイルやメモリ上にキーバリューデータとして保存しておく**
- そして、ブラウザーからアクセスがあった場合、クッキーからセッションIDを読み取りセッションIDをキーに、キーバリューデータから該当するユーザーデータを復元する
- キーバリューデータをサーバーのローカルファイルやメモリに保存するため、サーバーを複数設置して負荷分散させた場合、接続毎に接続先のサーバーが変わってしまうので、セッションが維持できなくなってしまう
- なので、どのサーバーにアクセスしても適切なユーザーデータが復元できるように、キーバリューデータをローカルではなく、データベースに格納することが多い。

## SPAでは？

シングルページアプリケーションの場合でも、セッションIDとクッキーが、トークンとAuthヘッダーに代わっただけで、暗号化されたIDから情報を取り出して確認するという基本的な考え方は同じ。

