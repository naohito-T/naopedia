# logs
[log level](https://en.wikipedia.org/wiki/Syslog#Severity_level)
log監視ツールが色々あるためそれをまとめる。

ログと言っても色々ある
- メトリクス収集
- ロギング
- 可視化
- アラート通知

## ユビキタス

- メトリクス
[metrics](https://e-words.jp/w/%E3%83%A1%E3%83%88%E3%83%AA%E3%82%AF%E3%82%B9.html)

## Tips
[zozoでの](https://techblog.zozo.com/entry/zozotown-backend-monitoring)

## ロギング行為の基本
[参考URL](https://expressjs.com/ja/advanced/best-practice-security.html)

>開発環境では許可されることが、実稼働環境では許可されないことがあります。例えば、開発環境ではデバッグのためにエラーの詳細なロギングを実行できますが、同じ動作が実稼働環境ではセキュリティー上の問題となります。

- 開発環境と本番環境で分ける。
- 本番で出すことはセキュリティー状の問題となってしまう場合がある；；

## ログレベル

おそらくほとんどのライブラリで使用するのではないか。
`all < trace < debug < info < warn < error < fatal < mark < off`

## 開発者のためのロギング
[参考URL](https://qiita.com/yukin01/items/33f20fc6efef3e783c85)

>一般的に、ある時点で起こったイベントとその時刻を記録することをロギングと呼びます。Web アプリケーションの場合は、Web サーバーのアクセスログやアプリケーションサーバーの実行ログ、及びエラーログなどを記録して、ストレージやログ集約サービスに永続化し、活用する仕組み全体を指していることが多いです。

ログを収集する目的はさまざまですが、いくつか例をあげると次の通りです。
セキュリティ要件を満たすためにアクセスログを長期間保存したい
不具合を調査するためにアプリケーションのエラーログを検索したい
アクセスログの統計情報をとってダッシュボードに表示したい

## ログの出し方

>基本的にログを出す時は流れでわかるようにせず1行で完結する形が好ましいです
>（DB: liver id: xx、DB: token: xx、みたいに、あと行を分けず全部1行で出していいと思います）
>現在は複数プロセスが一つのログに前後混ざることがないですが
>そういう処理を作る場合にこの書き方に慣れていると処理を追いにくい、追えないログになってしまいます
>またgrepなどで検索する際にも前後を出さないといけなくなってしまいます

>細かいところはリファクタリングのフェーズでいいと思いますが
>loggerの機能でできる部分と合わせて日時、ログ種別(info,warning,error)、PID、ログ内容、あとはログ発生タスクやUtilなどがわかるようになっていると検索性も良くなるので意識してもらえるといいと思います

## 3つのフェーズで導入する

- ログ出力
アプリケーションがどういう形でログを出力して、どう記録されるか
- ログローテート
無尽蔵に増えるログに対してどう対処するか
- ログ集約
どうやってストレージや外部サービスにログを永続化するか


---

## シングルトレーシング

モノリスなアプリケーションの対してトレーシングすること（一枚岩）

## 分散トレーシング
[参考URL（Goでの実装）](https://tech.every.tv/entry/2021/12/14/120000)

分散トレーシングとは分散されたアーキテクチャアプリケーションを監視するための手法。
マイクロサービスのような複数システムから構成されるアーキテクチャでは**複数のサービスを跨いで処理が動くため、全体の振る舞いを把握することが難しい課題。**
。 また、障害発生時に原因を特定することも困難です。 分散トレーシングの手法を用いることで、サービス間をまたいだ処理の計測や可視化が可能になり、それら課題の解決に繋がります。


### 用語

- トレース（Trace）
    トレースは、アプリケーションがリクエストを処理するのに費やした時間と、このリクエストのステータスを追跡するために使用されます。各トレースは、ひとつまたは複数のスパンで構成されます。

- スパン（span）
    スパンは、特定の期間における分散システムの論理的な作業単位を表します。複数のスパンでトレースが構成されます。

各サービスにおける処理の単位がスパンで表され、複数のスパンで構成される一連の全体処理がトレースで表されます。