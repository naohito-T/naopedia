# Authentication

ユーザ認証周りの理解と設計についてまとめる

[参考URL](https://applis.io/posts/how-to-authenticate-user)

## ユーザ認証の基本フロー

[参考URL(すばらしい)](https://applis.io/posts/how-to-authenticate-user)
[一番分かりやすい OAuth の説明](https://qiita.com/TakahikoKawasaki/items/e37caf50776e00e733be)

## ユビキタス

**リソースサーバ** : ユーザーのデータを管理するサーバ
**APIを守る仕組みのベストプラクティス** : アクセストークン(あらかじめクライアントアプリケーションに渡す)
**アクセストークンを発行する係** : 認可サーバ
※認可サーバにアクセストークンをくださいといい、渡すまでの流れを標準化したものがOAuth 2.0


### 基本的なユーザー認証のフロー

1. クライアントからサーバに認証情報をおくる
2. サーバー上で認証情報を検証する
3. 認証情報が正しければ、クライアントにアクセストークンを送る(+必要に応じてセッションに記録する)


たとえばフォームにメールアドレスとパスワードを入力・送信し、入力内容が正しければサーバーからアクセストークン(これがAPIにアクセスできる認識だが？)
が渡される、というイメージ

### ユーザ認証を設計する上で決めるべきこと

| 順番  | 項目 | 選択肢 |
| --- | --- | --- |
| 1 |  認証方法をどうするか   |  パスワード認証 or OpenID Connect(OAuth認証のこと「厳密には違うが」) |
| 2 |  アクセストークンをどう管理するか   | JWT |
| 3 |  アクセストークンをどうStateに保持するか | Authorizationヘッダ, Cookieヘッダ |
| 4 |  アクセストークンをどう保持するか   | OS標準のストア?, メモリ, Cookie, localStorage |

## 1(認証方法をどうするかについて) 概要

まず、ユーザー認証の方法には、大きく次の二つがある。

|     | 認証方法  | 概要 |
| --- | --- | --- |
| 認証方法1  | パスワード認証 | IDとパスワードをサーバに送る |
| 認証方法2  | OpenID Connect | 外部のプロバイダ上で認証しアクセストークンをサーバに送る |

- 認証方法2について
OpenID Connectは、OAuth認証と聞くとなじみがある。
たとえばGoogleやTwitterなどのアカウントによる認証。
ただ、『OAuth認証』という言葉には語弊がある。

---

### パスワード認証とは

**パスワード認証にも大きく分けて2つ**ある

1. Basic認証やDigest認証
2. 独自の認証機構

※2の独自認証機構は例として、フォームからIDとパスワードをサーバに送って、**ユーザ基盤**をもとに認証を行う一般的なやり方。
※この認証方法はパスワードを平文で送ることになるため、仮にSSLで通信を暗号化していたとしてもログにかかれて流出につながる

### ユーザ基盤とは

[クックパッドがユーザー基盤を再構築した話](https://techlife.cookpad.com/entry/2017/04/06/172601)




---

### 認証方法2について

OpenID ConnectはProtocolディレクトリに記載している。

## 2について

