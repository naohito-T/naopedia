# WebAPI

webでのapiをまとめる
- REST API
- GraphQL
- WebSocket API
[GraphQLとREST比較](https://ichyaku.com/shopify-graphql-rest/#:~:text=GraphQL%20API%E3%81%A7%E3%81%AF%E3%80%81Schema%E3%81%A7,%E6%B8%88%E3%81%BE%E3%81%9B%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%80%82)


## GraphQL

一度のアクセスで関連情報をすべて取得する。
所感
これTypeORMのRepositoryパターンとめちゃくちゃ合うな。
db取得をeagerにして一度で取得して一度で返す。
これはかなり効率がいい。

## REST API

たびたび必要な情報を取得するために何度から別のapiを叩く必要がある。

## 汎用的なapi処理に必要な処理


### バリデーション

外部から送られてくるデータを精査&整形する。

### Sanitization(サニタイゼーション) 和訳:消毒

整形する部分。
ノイズがないことを確認する。
理解として、空白のトリミングやHTMLエスケープなどのサニタイズを適用。
※重要
サニタイズによりリクエストが変更されることに注意。
これは、req.body.textが値とともに送信された場合`Hello world :>)`サニタイズ後にその値が`Hello world :&gt;`になること。


## Web API

Web APIを設計する際にさまざまなものを作成するかと思うがそれを記載する。

GET/POSTmethodしか使えない。

HTML4.0 `<form>`タグはmethod属性に追加できるのがGETとPOSTだけ。
初期のHTML5のドラフトではPUTやDELETEも使える仕様が盛り込まれたが、結局削除となった。

しかしapiがGETとPOSTにしか対応していないは使いにくい。
そういったケースにそなえ、よく利用されているケースは**API側でGETとPOST以外のメソッドをPOSTを使って表現する**方法が2つある。

どちらもメソッドとしてはPOSTを利用して、メタ情報として本当はこのメソッドが使いたいというふうにする

1. X-HTTP-Method-OverrideというHTTPリクエストヘッダーにDELETE or PUT入れる
こっちのが利用しやすい。

2. _methodパラメーター
railsで使用されている。


## WebAPIの通信

異なるマシン上で、動作するサービス間で情報をやり取りする手法について。
さまざまな情報システムの設計において、サービス間での情報のやり取りをどのように行うかというのは古くからある課題の1つ。
こういったサービス間での通信技術としてはさまざまなものがあるが、その中でも広く使われている手法の1つに**RPC**（Remote Procedure Call、直訳すると「遠隔手続き呼び出し」）がある。

## RPC(Remote Procedure Call)

RPCはいわゆるクライアント−サーバー型の通信プロトコルであり、サーバー上で実装されている関数（Procedure、プロシージャ）をクライアントからの呼び出しに応じて実行する技術。
クライアントはサーバーに対し実行する処理を指定するパラメーターや引数として与えるデータを送信し、それに対しサーバーはパラメーターに応じた処理を実行してその結果をクライアントに返す、というのがRPCの基本的な流れ。
RPCは古くからある考え方であり、インターネットが普及する以前より存在していた。

## 変化する部分

一方で、どのようにクライアントからリクエストを送信するかや、どのようなフォーマットでデータをやり取りするかについては時代に応じて変化しており、さまざまな実装が存在する。
近年のWebベースのシステムにおいてはHTTP/HTTPSベースでサーバー・クライアント間のやり取りを行い、またその際のデータフォーマートにはXMLを利用する「XML-RPC」や、同じくHTTP/HTTPSベースでデータフォーマットにJSONを利用する「JSON-RPC」といったものが多く使われている。

XML-RPCやJSON-RPCは、広く普及しているHTTP/HTTPSやXML、JSONといった技術を利用するため導入しやすいという利点がある。一方で、これらは基本的にテキストベースで情報をやり取りするためデータの転送効率が悪く、またバイナリデータを扱いにくいという問題があった。また、HTTP/HTTPSを使用しているため比較的長い期間で散発的にデータをやり取りしにくかったり、転送効率の面でもオーバーヘッドが存在したりする。

## 解決する通信プロトコル(gRPC)
[gRPCについて](https://knowledge.sakura.ad.jp/24059/)

上記の問題を解決するのが、gRPC

## gRPCの歴史と特徴

gRPCはGoogleが開発した、RPC技術がベースとなっている。
Googleでは多数のコンポーネントを組み合わせてサービスを実現する、いわゆる「マイクロサービスアーキテクチャ」でシステムを構築していることで知られるが、これらのサービス間での通信を行うためにgRPCの前身となる「Stubby」と呼ばれる技術が開発された。ただ、このStubbyはGoogleのインフラ以外での利用は想定しておらず、独自の仕様が多かったそうだ。その後Stubbyで使用されていた技術とコンセプトが近いHTTP/2などの技術が登場したことから、GoogleはStubbyにこれらの技術を取り入れてオープン化することを決め、それがgRPCとなった。gRPCはオープンソースで公開されており、現在はLinux Foundation傘下のCloud Native Computing Foundation（CNCF）によって開発が進められている

## gRPCの技術的概要

gRPCではほかのRPCと同様、クライアントがサーバーに対しリクエストを送信し、サーバーはそれに応じた処理を実行してその結果を返すという、クライアント−サーバーモデルを採用している。そして、gRPCは特定の言語やプラットフォームに依存しないように設計されており、さまざまな言語向けにクライアントやサーバーを実装するためのライブラリが公開されている。そのため、クライアントとサーバーが異なる言語で実装されていても、問題なく通信を行うことができるようになっている。

