# aws

aws関連

## s3

メンテナンス用画像を配置できる。まさかの方法もあった

## AWS CDK(Cloud Development Kit)

[参考URL](https://www.skyarch.net/column/aws-cloud-development-kit-cdk/)

AWS CDK(Cloud Development Kit)は**AWS上のリソースをコンポーネント化**して提供し、AWS上でのアプリケーション開発を支援するサービス
AWS Cloud DEvelopment Kitが必要とされる理由は、AWSを操作するその他の方法の課題を解決するためのもの

**AWSを操作する方法**
一番有名なのはマネジメントコンソール
マネジメントコンソールを始めるのは簡単だが以下の課題もある。
- 操作のために操作手順書が必要になる
- 画面を使った操作なので、繰り返し人間の操作が必要になる。
- 人間の操作はヒューマンエラーのリスクがある
- 作業に労力と時間がかかる

SDKやCLIといったスクリプトを使って操作手順を定義する方法は繰り返し使用することが可能だが、**アップデートを行う際にはその都度手順を変えなければならない。**

これらの、AWSを操作するその他の方法の持つ課題を解決するために活用されるのがAWS Cloud Development Kit (CDK)

AWS Cloud Development Kit (CDK)は、AWSの環境を一般のプログラム言語で記述できるツールで、オープンソースで開発されているので、ユーザーが拡張することも可能です。

## AWS CDK(Cloud Development Kit) メリット

- 簡単にawsサービスを活用できる
AWS Cloud Development Kit (CDK)では、専門的な知識が必要ではなく新たに学習することなく今まで活用してきた知識とスキルで使用が可能なため、AWSサービスを使ったアプリケーション開発を簡単に取り入れることができます。

- 現在使っているプログラミング言語やツールを使用できる
アプリケーション開発のために新しいプログラミング言語やツールが必要になると、時間と労力がかかります。AWS Cloud Development Kit (CDK)は、下記のような多くのプログラミング言語が使用でき、既に使用しているIDEやテストツール、ワークフローパターンを使用することができます。

TypeScript
Phthon
Java
.NET

- AWS CloudFormationとの連携
AWS Cloud Development Kit (CDK)を使ってインフラストラクチャを定義すれば、AWS CloudFormationに連携することで、Amazon EC2 インスタンスやAmazon RDSDB インスタンスといったAWSリソースを使ったプロビジョニングができます。

- コンポーネントをカスタマイズしてスピードを加速する
AWS Cloud Development Kit (CDK)では、開発チームや組織でAWSサービスをいくつか組み合わせて使う必要がある場合の組み合わせや、定型文、ロジックなどのコンポーネントを組織のセキュリティやコンプライアンス、ガバナンスなどを考慮したかたちでカスタマイズできます。

カスタマイズされたコンポーネントは繰り返し使用でき、開発チームや組織で簡単に共有できます。そのことで、新規のプロジェクトなどが発生してもスピーディーに開発を進めることが可能となります。


開発言語にTypeScriptを使用する場合はデプロイする前にCDKテンプレートがビルド(コンパイル)されている必要がある。

## CloudFormationは、AWS CDKから使うのが正解な気がしてきた

[参考URL](https://www.kwbtblog.com/entry/2020/11/21/100556)

## AWS CDKとは？

一言で言うとCloud Formation テンプレートジェネレーター
TypeScript等のプロブラム言語で、CloudFormationテンプレートを出力するプログラムが書けます。

また、出力したテンプレートを使ってCloudFormationへのデプロイもAWS CDK上で行うこともできます

## テンプレートをプログラムで書くとは

プログラムは下記のような流れになる

1. AWSの各種リソースがクラスとして定義されていて、デプロイしたいAWSリソースのクラスをnewでオブジェクトとして生成していきます。
2. オブジェクトは親子関係を持っていて、CloudFormationのスタックを頂点とした、リソースのオブジェクトツリーを構築していきます。

ユーザーが書くプロブラムはここまでで、このプロブラムを実行すると、構築されたオブジェクトツリー全体が、CloudFormationテンプレートとして出力されます。

## CloudFront

webでよく使われる
一番レイテンシーの低いサーバにアクセスがいく

- そもそもCDNとは？
CDNとはコンテンツデリバリーネットワークの略。
負荷分散をするためのコンテンツを配信するためだけのネットワークのことを指す
単にファイル(画像やZIPファイル)をダウンロードするための技術

- アクセス方法
CDNはwebサーバを並べるだけとは違い
アクセス元から見て一番近くにあるサーバを自動で選択してダウンロードさせることで表示が高速化される。
CDNのキャッシュサーバはアクセスされたキャッシュサーバにキャッシュがなかったらオリジンサーバ(稼働している元のWebサーバ)にアクセスを行い、データを取ってくることでwebサーバのように全てのサーバに同じデータを置かなくても良い。

## Cloudfront のメリット

- 高パフォーマンス
世界中の主要都市のほとんどに設置されているエッジロケーションを介してコンテンツ配信を行うことで高速な通信が可能になる。

- 可用性の向上
エッジロケーションを通してコンテンツ配信を行うことにより、オリジンサーバのワークロードを減らし、アプリケーションの可用性を高めることができる。

- 無料のHTTPS証明書を提供している


## S3とAmazon CloudFrontの違い

[参考URL](https://www.acrovision.jp/service/aws/?p=1441)

ファイルのダウンロードを目的として場合、AmazonS3だけでも事足りるように思えるが、CloudFrontを利用した際のメリットとは
Amazon CloudFront を利用しないで直接 Amazon S3 などのオリジンサーバーからオブジェクトを取得した場合を比較したとき、一番大きな特徴がエッジデリバリーによるメリットの有無となります。


[nuxt.js S3と CloudFrontを使用してAWSへデプロイ](https://develop365.gitlab.io/nuxtjs-2.8.X-doc/ja/faq/deployment-aws-s3-cloudfront/)
[S3とCloudFrontでホストしたNuxtjsをGithub Actionsでデプロイする](https://www.blog.danishi.net/2021/04/30/post-4897/)


AWS CDKを使ってS3とCloudFrontを作成する
作成した後、SPAをdeployする
まあ料金は高くなるだろう。

## マルチAZ配置

マルチAZとは、米アマゾンドットコム（Amazon.com）社のAmazon Web Services（AWS）におけるシステム構成の一つで、複数のアベイラビリティゾーン（AZ）にまたがってシステムの配置を行う方式。

AZ = アベイラビリティーゾーン

## Serverless Framework

LambdaはAWSコンソールから作成できるが、コードのGit管理、ローカルでのデバッグ、デプロイの自動化などを行おうとする場合、何らかしらのツールを使用することが一般的。

その際に使用する代表的なツールとして、 Serverless Frameworkがある。
Serverless Frameworkは、AWS以外のプラットフォームでも使用できるマルチクラウド対応のサーバレスアプリケーション開発支援ツールです。

## CloudFormation

CloudFormationはプログラミング言語やテキストファイルを使用してAWSリソースを自動で構築するサービスです。 所望のAWS環境をテンプレート化しておくことで、同じ環境を作成する時間を削減することができます。

## AWS アクセスキー

**アクセスキーはAWSで個人で識別する認証情報(ユーザ名のようなもの)**

AWSにアクセスするにはまずアクセスキーが必要。
アクセスキーはAWSで個人で識別する認証情報であり、アクセスキーID(ユーザ名のようなもの)とシークレットアクセスキー(パスワードのようなもの)

## S3のアクセスキーとシークレットキーを作る方法

[参考URL](https://off.tokyo/blog/s3-aws/)

1. S3のアクセスキーとシークレットキーを作成するにはIAMユーザを作る必要がある。
2. グループのを作る
3. グループの名前と使用用途を決める。例: node.jsからs3へ画像をアップしたrい、取得したり

## バージニア北の理由

バージニア北のが色々制限はゆるい。


## CloudFrontとAPI Gatewayの違い

API GatewayがListenするのはHTTPSのみで、**HTTPリクエストを受け付ける事はできない**
一方、CloudFrontはHTTPとHTTPSの両方のリクエストを受けられるのでCloudFrontを経由することでAPI GatewayへのリクエストをHTTPで受けることができる。

