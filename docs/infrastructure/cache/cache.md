# cache まとめ

[素晴らしいblog](https://blog.yuuk.io/entry/2019/survey-coordinated-caching?amp=1)

## cacheの重要性

Webサービスの応答速度を向上させることにより、ユーザー体験向上につながる。
実際に40%以上のWebサービスのユーザーはページの読み込みを3秒以上待てないという調査結果がある。
クラウドコンピューティングを利用し、Webサービスを提供する場合の読み込み遅延の要因は次の3つ。

1. クラウドのデータセンター内での処理遅延
2. エンドユーザーとデータセンター間のネットワーク転送遅延
3. ブラウザ上でのコンテンツ表示遅延

## 過去のcache

Webサービスを提供する企業は、Akamai・CloudFront・Fastlyなどの事業者が提供するCDN(Content Delivery Network)を以前より活用し、**画像や動画などの静的コンテンツの配信を高速化**してきた。

## 最近のcache

近年では、一度キャッシュされたデータを破棄するまでの処理時間が高速化したことにより**動的コンテンツのキャッシュにもCDNを利用することがある。**
さらには、単なるキャッシュを配信するだけでなく、**CDNのエッジサーバ上**で要求に対して任意の処理を実行できるように、エッジサーバに任意のアプリケーションを配置することが可能となる**CDN Edge Workerと呼ばれるサービス**が登場している。

プログラミング言語処理系の制約があるものの、CDN Edge Workerとしては、AWS Lambda@Edge2・Cloudflare Workers3・fly.io4などがある。

## 動的コンテンツに対するCDN

すべてのエッジでキャッシュが無効化されるまでに遅延があり、キャッシュ間またはキャッシュとオリジンの**データ間の一貫性が弱い**という課題がある。
CDN Edge Workerにおいてもアプリケーションの配置は可能であるが、データの一貫性については厳密に保証するデータストアが提供されているわけではない。

## エッジコンピューティング

CDN以外にも、**エンドユーザーとクラウドのデータセンターの間に中間層**を設けることにより、ネットワークレイテンシを最小化するエッジコンピューティングが研究されている。
エッジコンピューティングの研究分野では、IoT (Internet of Things)。スマートシティ、仮想現実などの従来のPCやスマートフォン以外のエンドデバイスを活用するような新しいコンピューティングへの適用が主目的となっている。

[エッジコンピューティング参考URL](https://memo.yuuk.io/entry/2019/learning-edge-computing01)

---

## 分散キャッシュの関連技術

**Webアプリケーションの読み出し性能を向上するためのキャッシュの要素技術**を整理し、その特徴を列挙する。
要素技術として、オブジェクトキャッシュ・クエリリザルトキャッシュ・HTTPキャッシュ・ICN(Information-Centric Networking)がある。

### オブジェクトキャッシュ

オブジェクトキャッシュは**アプリケーションが任意のオブジェクトをキャッシュ**するための機構。
オブジェクトキャッシュのためのデータストアとして、
1. アプリケーションプロセスが**ネットワーク通信して**利用するネットワーク型の分散キャッシュシステム
2. アプリケーションプロセスと**同一のメモリ空間に**キャッシュデータを保持する組み込み型の分散キャッシュシステム


- ネットワーク型の分散キャッシュシステム
`Memcached`や`Redis`が広く利用されている。
これらのキャッシュシステムを複数のキャッシュノードへ負荷分散するために、**ハッシュ法を利用することにより**オブジェクトのキーと分散先のキャッシュノードを紐付けし、オブジェクト単位で分散させてキャッシュノードへデータを配置する。
この手法は、キャッシュノードの追加または削除時にオブジェクトのキーとノードの紐づけが変更され、大部分のキーを再配置することにより性能が低下するという課題をもつ。
そこで、ノードの追加・削除時にオブジェクトのキーとノードの割り当てをなるべくかえずに、分散するためにコンシステントハッシュ法が利用される。


### クエリリザルトキャッシュ

[参考URL](https://blog.yuuk.io/entry/2019/survey-coordinated-caching?amp=1#fnref:7)
データベースミドルウェア層でキャッシュする場合、DBへの**クエリの結果をキャッシュ**するクエリリザルトキャッシュを利用する。
MySQLのクエリリザルトキャッシュは、**DBサーバ自体がキャッシュ機構をもつため追加のソフトウェアなしに**クエリリザルトキャッシュを利用できる。
テーブルに更新があれば当該テーブルの変更が結果に影響するクエリのキャッシュを破棄するため、テーブルとキャッシュ間で一貫性を維持する


