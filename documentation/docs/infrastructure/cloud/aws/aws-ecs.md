# Amazon ECS (Elastic Container Service)

コンテナー化されたアプリケーションのデプロイメント・管理・およびスケールアップを行うためのフルマネージドサービス。  
aws上でいい感じにdocker pull（ECRから）して、docker runしてくれる感じ。

## 特徴

- Dockerと互換性があります。
- タスクとサービスの概念を提供して、アプリケーションのコンポーネントを管理します。
- タスク定義を使用して、コンテナーのセットを指定します。
- サービスを使って、タスクのセットを維持・スケーリングできます。
- **Fargate**というサーバレスコンピューティングエンジンを提供しています。これを使用すると、インフラストラクチャの管理を気にすることなく、コンテナーを直接実行できます。

## ECSがない場合の運用docker

今まではEC2上にdocker engineをインストールして、その上でコンテナーを管理するという方法だった。  
この場合、コンテナーごとにポート変えないといけなかったり、コンテナーで何かしら不具合起きたら`ssh`でログインして原因特定して治して、起動し直さないといけなかったりしないといけなかった。  
また、アクセス集中してサーバー台数増やす時にまた環境構築しないといけなかったり、何かと監視が必要になってくる。

そこでECSの出番となる。  
ECSでは上記のような問題をすべて解決してくれる。ポートマッピング、コンテナーの状態の監視、自動復旧などをおこなってくれる。

## ECS関連の単語

### Cluster(クラスター)

タスクやサービスを使う論理的なグループ。  
コンテナーを動かすEC2やfargateの集合体のことをいう。  
クラスターはリージョン固有の存在で跨ぐことはできない。

### Service

Taskをまとめて管理するもの。同じサービス内で起動しているTaskは同じTask Definitionからできている。

### Task Definitionとは

ECSでコンテナーを起動するための情報を記載したもの。  
- どのimageでコンテナー起動するのか
- cpuとメモリはどうするのか
- portはどうするかとか
- コンテナーが終了したり失敗した時に起動し直すのかどうかとか設定する。  
※docker-compose.yml的な立ち位置でdocker-compose.ymlファイルでタスク定義ができる。

### Taskとは

Task Definitionを元に起動した各コンテナー（またはコンテナーの集まり）のこと。
Railsでよくあるコンテナーの構成で例えるなら、appで1タスク、nginxで1タスク、dbで1タスクみたいなイメージ。

## Fargateとは

Fargateはサーバーの管理が不要なコンテナー向けのサーバーレスコンピューティングエンジン。EC2を利用した場合、自分でサーバーを起動してecs起動してと言うことをしていたが、Fargateを利用した場合は、ECSのServiceの状態によってTaskを自動的に起動したり終了したり、設定によってTask数を増やしたり減らしたりといったことを自動でしてくれる。EC2では起動していた分だけ課金されるが、Fargateの場合はリソースに対しての従量課金となっているため、コスパがいい。



