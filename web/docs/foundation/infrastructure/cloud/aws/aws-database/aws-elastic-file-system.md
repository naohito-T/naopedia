# Amazon Elastic File System(Amazon EFS)

Amazon EFSはフルマネージドで提供されるネットワークファイルストレージサービス。  
フルマネージド型のファイルシステムをわずか数秒で作成できる。  
ネットワークファイルストレージといえば、オンプレミスにおけるNAS（ネットワーク接続ストレージ）や、クラウド上にファイルを保存して共有するサービスである「Dropbox」がいい例  
EFSはこうしたファイル共有をAWS上で実現するサービス。

## EFSの特徴

EFSはEC2インスタンスにマウントして利用する、Linuxベースのストレージサービスです。さまざまな特徴がありますが、SAA試験でも出題されやすい特徴に絞って解説します。

### 同時アクセス

最大で数千台のEC2インスタンスやオンプレミスサーバーから同時にアクセス可能です。

### 高い可用性、耐久性

データは複数のAZに跨って自動的に複製されるため、最大99.99%（フォーナイン）の可用性を発揮する。  
また、AWS Backupにより自動的に生成されるバックアップデーターが3つのAZにレプリケートされることで、99.999999999%（イレブンナイン）の耐久性を獲得することもできる。

[![Image from Gyazo](https://i.gyazo.com/27634f384a63e0a144dd92e32257f560.png)](https://gyazo.com/27634f384a63e0a144dd92e32257f560)

### スケーラブル

プロビジョニングが不要で、データの増減に応じてストレージ容量が自動的にスケーリングされる。

### 強い一貫性

更新が即時に反映されるため、常に最新のデータにアクセスできる

### ファイルロック

編集中のデータは**ロックされる***ため、作業の競合を防止できる。

### クロスリージョンレプリケーション(CRR)

選択したリージョンもしくはAZで、EFSファイルシステムのコピーを自動的に維持できる。  
ただし、次のような点には、注意する必要がある。  

1. レプリケーション先のファイルは更新不可（ReadOnly）
2. 設定時に既存のEFSはレプリケーション先として設定不可
3. レプリケーション設定を削除することでレプリケーション先EFSのファイルが編集可能（フェイルオーバー）

## ストレージクラスの種類

EFSはアクセス頻度や用途に応じて最適なパフォーマンスを発揮する4種類のストレージクラスを用意している。  

1. 標準ストレージクラス
2. 標準ー低頻度アクセスストレージクラス（標準ーIA）
3. 1ゾーンストレージクラス
4. 1ゾーン低頻度ストレージクラス（1ゾーンーIA）

## パフォーマンスモードの種類

EFSは、幅広いワークロードに対応するために必要なスループット・IOPS・低レイテンシーを提供できるよう設計されており、汎用モードと最大I/Oパフォーマンスモードの2つのパフォーマンスモードがあり、次のような特徴がある

### 汎用モード

ファイルサービスなど一般的な用途を想定したモードで、レイテンシーを優先する場合に使用する。

### 最大I/Oパフォーマンスモード

各ファイル操作のレイテンシーが汎用モードに比べ、わずかに高くなります。代わりに、数十〜数千のクライアントから同時にリクエストを受けるような、合計スループットを優先する場合に使用するモード。

## スループットを選ぶ際

秒間にどれだけのデータをストレージに書き込むかによって変わってくる。  
EFSには2つのスループットモードが用意されている。

### バーストスループットモード

EFSのデフォルトのスループットモードです。 スループットはファイルシステムのサイズに合わせてスケールされ、ファイルベースの多数のワークロードの不規則な性質に対応するため、必要に応じて動的にバーストされます。ベースラインのスループットは、1GBあたり50KB/秒で、保存されているデータ量に応じてスループットと期間が設定されます。1TBを超えると、毎日12時間、ストレージの1TBあたり100MB/秒までバーストできるバーストクレジットが貯まるよう設計されています。

### プロビジョニングスループットモード

プロビジョンドスループットモードでは、デフォルトのバーストスループットモードより一貫したスループット（50MB/秒を保証）が提供され、ストレージへのスループット速度が高いアプリケーションや、バーストモードでクレジットを使い果たし低速になってしまった場合に使用します。
